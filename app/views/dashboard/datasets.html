{% extends 'dashboard/base.html' %}

{% block tabstyles %}
<style type="text/css">
	.panel {
		margin-top: 20px;
	}
	.recent-view {
		margin-top: 20px;
		border-right: 1px solid #f5f5f5;
	}
	.recent-view #search-field {
		margin-bottom: 20px;
	}
	.recent-view .list-group {
		height: 80vh;
		overflow-y: scroll;
	}
	.recent-view .list-group .content {
		width: 80%;
		display: inline;
	}
	.recent-view .list-group .btn {
		float : right;
	}
</style>
{% endblock %}

{% block tabs %}
<li class="active">
	<a data-toggle="collapse" href="#dataset-sections" 
		aria-expanded="false" 
		aria-controls="dataset-sections">
		Datasets
	</a>
	<ul class="collapse nav" id="dataset-sections">
		<li><a href="/dashboard/">Public datasets</a></li>
		<li><a href="/dashboard/?my">My Datasets</a></li>
	</ul>
</li>
<li><a href="/bookmarks/">Bookmarked</a></li>
<li><a href="/upload/">Upload data file</a></li>
{% endblock %}

{% block tabdetails %}
<div class="row">
	<div class="col-xs-12 col-sm-4 col-md-3 recent-view">
		{% if messages %}
			{% for message in messages %}
				<div class="alert alert-{{ message.tags }} alert-dismissible" role="alert" style="margin-top:10px;">
					<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
					{{ message }}
				</div>
			{% endfor %}
		{% endif %}
		<input type="text" id="search-field" class="form-control" placeholder="Search for dataset">
		<ul class="list-group" data-bind="foreach: datasets">
			<li class="list-group-item clearfix">
				<button class="btn btn-primary btn-sm">View</button>
				<div class="content">
					<h4 class="list-group-item-heading" data-bind="text: title"></h4>
	    			<p class="list-group-item-text">uploaded by 
	    				<a data-bind="attr: { href : 'mailto:' + uploaderEmail()}, text: uploaderEmail"></a>
	    			</p>
				</div>
			</li>
			<!-- Loader -->
			<li class="loader-list-item">
				<div class="center-block">
					<i class="fa fa-circle-o-notch fa-spin fa-2x fa-fw"></i>
				</div>
			</li>
		</ul>
	</div>
	<div class="col-xs-12 col-sm-8 col-md-9">
		<div id="graph" class="center-block vega"></div>
		<div class="row" style="margin-top: 20px">
			<div class="col-sm-10">
				<ul class="nav nav-tabs" role="tablist">
					<li role="presentation" class="active"><a href="#info-console" aria-controls="info-console" role="tab" data-toggle="tab">Information console</a></li>
					<li role="presentation"><a href="#egonet" aria-controls="egonet" role="tab" data-toggle="tab">EgoNet</a></li>
					<li role="presentation"><a href="#adj-maxtrix" aria-controls="adj-maxtrix" role="tab" data-toggle="tab">Adj Matrix</a></li>
				</ul>
				<div class="tab-content">
					<div role="tabpanel" class="tab-pane active" id="info-console">
						<table class="table table-hover">
						  <thead>
						  	<tr>
						  		<th>Node ID</th>
						  		<th>Number</th>
						  		<th>Degree</th>
						  		<th>Degree(U)</th>
						  		<th>PageRank</th>
						  		<th>Eigenvector</th>
						  		<th>Egonet</th>
						  		<th>Adj matrix</th>
						  	</tr>
						  </thead>
						  <tbody>
						  	<tr>
						  		<td>466</td>
						  		<td>1-85e</td>
						  		<td>65</td>
						  		<td>10</td>
						  		<td>2.6e-05</td>
						  		<td>2.2009e-7</td>
						  		<td><button class="btn btn-primary btn-sm">View</button></td>
						  		<td><button class="btn btn-primary btn-sm">View</button></td>
						  	</tr>
						  </tbody>
						</table>
					</div>
					<div role="tabpanel" class="tab-pane" id="egonet">...</div>
					<div role="tabpanel" class="tab-pane" id="adj-maxtrix">...</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block scripts %}
<!-- Vega js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.28/vega.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-alpha.7/vega-lite.js"></script>
<script src="https://vega.github.io/vega-embed/vega-embed.min.js"></script>
<script type="text/javascript">
	// init view model
	var view = new View({
		el : document.getElementById('recent-view'),
		data : {
			datasets : [
				{
					title : "Phone number linked nodes",
					uploaderEmail : "example@example.org"
				}
			]
		}
	});
	// search action
	$('#search-field').keyup(function() {
		// extract current val
		var query = $(this).val();
		// send search request
		http.post('/search/', {
			query : query
		}).then(function(res) {
			if (res.data['status'] == 'success') {
				view.data().datasets(res.data['datasets']);
			} else {
				console.log("NO MATCH!");
			}
		}).catch(function() {
			console.log("SEARCH ERROR!");
		});
	});
	// vega test init
	vega.embed('#graph', '/static/data/config/iris.json');

</script>
{% endblock scripts %}