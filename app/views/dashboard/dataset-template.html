{% extends 'dashboard/base.html' %}

{% block tabstyles %}
<style type="text/css">
#priority-selector a {
	display: inline;
}
</style>
{% endblock %}

{% block tabs %}
<li class="active">
	<a data-toggle="collapse" href="#dataset-sections" 
		aria-expanded="false" 
		aria-controls="dataset-sections">
		Datasets
	</a>
	<ul class="collapse nav" id="dataset-sections">
		<li><a href="/dashboard/">Public datasets</a></li>
		<li><a href="/dashboard/?my">My Datasets</a></li>
	</ul>
</li>
<li>
	<a data-toggle="collapse" href="#bookmark-sections" 
		aria-expanded="false" 
		aria-controls="bookmark-sections">
		Bookmarks
	</a>
	<ul class="collapse nav" id="bookmark-sections">
		<li><a href="/bookmarks/">Public bookmarks</a></li>
		<li><a href="/bookmarks/?my">My bookmarks</a></li>
	</ul>
</li>
<li><a href="/upload/">Upload data file</a></li>
{% endblock %}

{% block tabdetails %}
<div class="row">
	<div class="col-sm-10">
		<div class="row" style="margin-top: 20px">
			<div class="col-sm-10">
				<ul class="nav nav-tabs" role="tablist">
					<li role="presentation" class="active"><a href="#info-console" aria-controls="info-console" role="tab" data-toggle="tab">Information console</a></li>
					<li role="presentation"><a href="#egonet" aria-controls="egonet" role="tab" data-toggle="tab">EgoNet</a></li>
					<li role="presentation"><a href="#adj-maxtrix" aria-controls="adj-maxtrix" role="tab" data-toggle="tab">Adj Matrix</a></li>
					<li style="float:right">
						<span class="star" data-toggle="tooltip" data-placement="right" title="Click to bookmark/unbookmark">
							<span class="star-icon fa fa-star" ></span>
						</span>
					</li>
				</ul>
				<div class="tab-content">
					<div role="tabpanel" class="tab-pane active" id="info-console">
						<table class="table table-hover">
						  <thead>
						  	<tr>
						  		<th>Node ID</th>
						  		<th>Number</th>
						  		<th>Degree</th>
						  		<th>Degree(U)</th>
						  		<th>PageRank</th>
						  		<th>Eigenvector</th>
						  		<th>Egonet</th>
						  		<th>Adj matrix</th>
						  	</tr>
						  </thead>
						  <tbody>
						  	<tr>
						  		<td>466</td>
						  		<td>1-85e</td>
						  		<td>65</td>
						  		<td>10</td>
						  		<td>2.6e-05</td>
						  		<td>2.2009e-7</td>
						  		<td><button class="btn btn-primary btn-sm">View</button></td>
						  		<td><button class="btn btn-primary btn-sm">View</button></td>
						  	</tr>
						  </tbody>
						</table>
					</div>
					<div role="tabpanel" class="tab-pane" id="egonet">...</div>
					<div role="tabpanel" class="tab-pane" id="adj-maxtrix">...</div>
				</div>
			</div>
		</div>
		<div id="graph" class="center-block vega"></div>
	</div>
</div>
<!-- Bookmark creator -->
<div class="modal fade" id="bookmark-creator" tabindex="-1" role="dialog" aria-labelledby="bookmark-creator">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="bookmark-creator">Bookmark the selection</h4>
			</div>
			<div class="modal-body">
				<div>
					<div class="form-group">
						<label for="priority">Please select a priority</label>
						<div class="dropdown">
							<button class="btn btn-default dropdown-toggle" type="button" id="priority-selector" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
								<span data-bind="text: priority"></span>
								<span class="caret"></span>
							</button>
							<ul class="dropdown-menu" id="priority-selector" aria-labelledby="priority-selector">
								<li style="padding: 10px">
									<span style="background-color: red; width: 20px; height: 20px; float: left"></span>
									<a data-bind="click: selectPriority('high', 2)">High</a>
								</li>
								<li style="padding: 10px">
									<span style="background-color: yellow; width: 20px; height: 20px; float: left"></span>
									<a data-bind="click: selectPriority('medium', 1)">Medium</a>
								</li>
								<li style="padding: 10px">
									<span style="background-color: green; width: 20px; height: 20px; float: left"></span>
									<a data-bind="click: selectPriority('low', 0)">Low</a>
								</li>
							</ul>
						</div>
					</div>
					<div class="checkbox">
						<label>
						<input type="checkbox"> Do you want to publicize it?
						</label>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary">Create</button>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block scripts %}
<!-- Vega js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.28/vega.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-alpha.7/vega-lite.js"></script>
<script type="text/javascript">
	// init view models
	var bookmarkView = new View({
		el : document.getElementById('bookmark-creator'),
		data : {
			priority : 'medium',
			priorityVal : 0,
			publicized : ''
		},
		methods : {
			selectPriority : function (val, level) {
				this.priority(val);
				this.priorityVal(level);
			}
		}
	});
	// star toggling action
	$('.star').click(function() {
		// show modal prompt to create bookmark
		$('#bookmark-creator').modal();
	});

	// vega test init
	var vegaView = null;
	vega.loader().load('/static/data/config/iris.json')
		.then(function(data){
			// init view
			var spec = JSON.parse(data);
			if (vegaView) vegaView.finalize();
			vegaView = new vega.View(runtime = vega.parse(spec));
			vegaView.logLevel(vega.Warn)
					.renderer('canvas')
					.initialize(document.querySelector('#graph'))
					.hover()
					.run();
			// try click listener
			console.log(vegaView.scenegraph());
			vegaView.addEventListener('click', function (event, item){
				console.log(item);
			});
		})

</script>
{% endblock scripts %}