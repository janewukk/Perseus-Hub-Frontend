{% load static %}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/static/images/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/static/images/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/static/images/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/static/images/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/static/images/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/static/images/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/static/images/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/static/images/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/static/images/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="/static/images/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/static/images/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon-16x16.png">
	<link rel="manifest" href="/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="/static/images/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">
	<title>Perseus</title>
	<!-- Normalize CSS -->
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<!-- Fontawesome -->
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- Boostrap theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
	<!-- App CSS -->
	<link rel="stylesheet" type="text/css" href="{% static 'css/app.css' %}" />
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    {% block styles %}
    {% endblock %}
</head>
<body>
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/dashboard/">
					<img alt="Persus" height="30r" src="/static/images/logo.png" 
						 style="display: inline">
					Perseus
				</a>
			</div>
		
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				
					<ul class="nav navbar-nav navbar-right">
						{% if auth_user.is_authenticated %}
						<form class="navbar-form navbar-left" role="search" id="nav-search-form">
							<div class="form-group">
								<input type="text" id="search-field" class="form-control" placeholder="Search public datasets" autocomplete="off">
								<ul class="list-group search-dropdown" data-bind="visible: showDropdown, foreach: results">
									<li class="list-group-item">
										<a data-bind="attr: { href : url }, text: title"></a>
									</li>
								</ul>
							</div>
						</form>
						<li style="right: 7px">
							<button onclick="window.location.href='/settings/'" class="btn btn-primary navbar-btn">Settings</button>
							<button onclick="window.location.href='/logout/'" class="btn btn-danger navbar-btn">Logout</button>
						</li>
						{% endif %}
						{% block navitems %}
						{% endblock %}
					</ul>

			</div>
		</div>
	</nav>
	<div class="container-fluid" id="content">
		{% block content %}
		{% endblock %}
	</div>
	{% csrf_token %}
	<!-- Jquery js -->	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<!-- Boostrap js -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<!-- Jquery cookie -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.3/js.cookie.min.js"></script>
	<!-- Knockout js -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.1/knockout-min.js"></script>
	<!-- Vendor js -->
	<script src="{% static 'js/vendor.js' %}"></script>
	<!-- App js -->
	<script src="{% static 'js/app.js' %}"></script>
	<!-- Search -->
	<script type="text/javascript">
		// init view model
		var searchView = new View({
			el : document.getElementById('nav-search-form'),
			data : {
				results : [],
				showDropdown : false
			}
		});
		// search action
		var timer;
		$('#search-field').keyup(function() {
			// clear previous timeout
			clearTimeout(timer);
			// extract current input
			var query = $(this).val();
			if (query == "") {
				// hide dropdown
				searchView.data().showDropdown(false);
				return;
			}
			// show dropdown
			searchView.data().showDropdown(true);
			// delayed search
			timer = setTimeout(function() {
				// send search request
				$.ajax({
					'url': "/search/",
					'method': "POST",
					'data': {
						'query' : query
					}
				}).done(function(res) {
					if (res['status'] == 'success') {
						var rawData = JSON.parse(res['data']);
						var results = []
						rawData.forEach(function(item){
											results.push({
												title : item['fields']['title'],
												url : "/datasets/" + item['pk']
											});
										});

						searchView.data()
								  .results(results);
					} else {
						searchView.data().results([
							{
								title : ob("No matches found!"),
								url : "#"
							}
						]);
					}
				}).fail(function() {
					console.log("SEARCH ERROR!");
				});
			}, 500);
		});
	</script>
	{% block scripts %}
	{% endblock %}
</body>
</html>